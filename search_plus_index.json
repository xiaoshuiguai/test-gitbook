{"./":{"url":"./","title":"环境准备","keywords":"","body":" Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-03-30 11:37:18 "},"0-enverionment/iptables.html":{"url":"0-enverionment/iptables.html","title":"防火墙关闭","keywords":"","body":"关闭防火墙 需首先执行关闭防火墙命令 注意：断电后也需确保防火墙处于关闭状态 # 查看防火墙状态 service iptables status # 开启防火墙 service iptables start # 关闭防火墙 service iptables stop Linux CentOS 7可能为以下命令，同样要关闭防火墙。 #1、启动防火墙 systemctl start firewalld #2、关闭防火墙 systemctl stop firewalld #3、重启防火墙 systemctl restart firewalld #4、查看防火墙状态 systemctl status firewalld #5、开机禁用防火墙 systemctl disable firewalld #6、开机启用防火墙 systemctl enable firewalld #7、查看防火墙开机是否启动 systemctl is-enabled firewalld #8、查看已启动的服务列表 systemctl list-unit-files|grep enabled #9、查看启动失败的服务列表 systemctl --failed Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"0-enverionment/jdk.html":{"url":"0-enverionment/jdk.html","title":"jdk安装","keywords":"","body":"jdk安装 平台各个应用服务以及适配器要求的jdk版本不尽相同，但安装方法类似，应用服务器1(WEB服务)中需要jdk版本为1.7，故需要安装jdk1.7版本jdk。 下面以1.7jdk为例，将jdk安装文件拷贝至主备在服务器上，jdk的安装很简单，重点在配置环境变量上，下面以jdk1.7.0_45版本为示例： 卸载原有无用jdk 注意：若还出现类似以下界面，则需要先卸载自带的jdk版本。（不能使用openjdk） 先查看原有jdk，命令为： rpm -qa|grep java 然后输入如下命令进行卸载（--nodeps后面的java信息由系统自带的具体版本确定）： rpm -e --nodeps java-1.7.0-openjdk-1.7.0.45-2.4.3.3.el6.x86_64 jdk安装步骤 将下载的jdk安装文件jdk-7u79-linux-x64.rpm拷贝到/usr/java里，并将其解压，命令为： rpm -ivh jdk-7u79-linux-x64.rpm 在/etc/profile里面增加环境变量： export JAVA_HOME=/usr/java/jdk1.7.0_79 export JAVA_BIN=/usr/java/jdk1.7.0_79/bin export PATH=$PATH:$JAVA_HOME/bin:$JAVA_HOME/jre/bin export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar export JAVA_HOME JAVA_BIN PATH CLASSPATH 注意，linux中环境变量是以\":\"分割的，不是\";\"，目录要设置正确，特别注意不要有空格等 使用环境变量配置生效，命令为： source /etc/profile 查看jdk是否安装好：java –version，显示类似如下信息说明安装配置正确。 Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"0-enverionment/oracle.html":{"url":"0-enverionment/oracle.html","title":"数据库","keywords":"","body":"Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"0-enverionment/sql.html":{"url":"0-enverionment/sql.html","title":"数据库脚本","keywords":"","body":"Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"0-enverionment/maptiles.html":{"url":"0-enverionment/maptiles.html","title":"离线瓦片","keywords":"","body":"离线瓦片器 注意：需要在可以连接互联网的情况下进行下载，下载时可先设置一个级别（在配置文件conf.properties中仅仅设置zoom=10）进行下载测试，下载完成后进入设置的下载路径downloadDir看是否有图片可以下载到。若可以下载到，则进行1到17级统一下载。 具体参看以下配置。 用文档编辑器打开bin目录下的conf.properties文件中，修改以下参数。 #download directory 下载路径 downloadDir=D:\\\\GoogleMap\\\\ #zoom=10,11,12,13,14,15（下载至17级） zoom=1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17 #leftTopLnglat 118.188171，37.779399 左上角经纬度 leftTopLnglat=119.48046,37.14453 #rightBottomLnglat 119.292297，37.18439 右下角经纬度 rightBottomLnglat=120.99804,35.57031 注意：左上、右下角经纬度由所在地市经纬度确定。可由百度坐标拾取网站获得http://api.map.baidu.com/lbsapi/getpoint/index.html 也可由下载包中的getPos.html页面获取。 配置完成后保存，双击start.bat。开始下载。 常见问题： jdk版本问题，下载1.7jdk进行下载。 Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"1-chapter/":{"url":"1-chapter/","title":"应用服务器(WEB应用)","keywords":"","body":"安保平台服务之间关系 输入平台地址后，首先跳转登录页（HiATMP-sso） 登录后进入五个球的菜单页面（HiATMP-BSP） 左上角可进入工作台（HiATMP-wbc） 工作台可进行设备运维（HiATMP-eoms,HiATMP-eomsbase） 道路路口维护（HiMap） 地图服务通过Geoserver 发布第三方路网数据，展示深色地图 部署见应用服务器(WEB应用)章节Geoserver 通过瓦片展示浅色地图。 通过菜单可进入安保页面（HiATMP-LEG） 依赖VideoService看视频 部署见应用服务器(WEB应用)章节VideoService 依赖HiLEG-HiCON获取信号灯态，驻留信号机 部署见其他服务章节hileg-hicon 以上服务均通过日志服务记录日志(HiATMP-LOG) Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"1-chapter/1.web-port.html":{"url":"1-chapter/1.web-port.html","title":"端口规划","keywords":"","body":"应用服务器（WEB应用）端口规划 第三方服务 适配器 说明 端口 active-mq服务 消息中间件-mq服务 8261/61616 zookeeper 2181 tomcat服务 工程名称 tomcat的conf目录下server.xml tomcat的conf目录下server.xml tomcat的conf目录下server.xml tomcat的conf目录下server.xml 项目名.properties web服务端口 Shutdown端口 AJP端口 redirectPort端口 dubbo端口 1 sso 801 18010 18011 18012 2801 2 log 803 18030 18031 18032 2803 3 bsp 80 18000 18001 18002 280 4 eoms-base 802 18020 18021 18022 2802 5 wbc 812 18120 18121 18122 2812 6 himap 804 18040 18403 18042 2804 7 leg 8002 18500 18501 18502 28002 8 eoms 81 18100 18101 18102 281 9 dubbo 9090 29090 29091 29092 Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"1-chapter/2.zookeeper.html":{"url":"1-chapter/2.zookeeper.html","title":"zookeeper安装","keywords":"","body":"安装zookeeper Zookeer主要为各子系统和平台运行提供一致性协调服务。系统间的后台间接口的调用使用的就是zookeeper。解压缩zookeeper服务器压缩包（如zookeeper-3.4.6.tar.gz）到相应安装目录。 修改配置文件 修改zookeeper-3.4.6/conf/zoo.cfg文件 #数据目录，如：/usr/zookeeper dataDir=/usr/zookeeper #连接端口如:2181,为后期各package配置使用 clientPort=2181 启动zookeeper 在zookeeper目录下，执行以下命令 sh bin/zkServer.sh start 验证 可在dubbo启动后，查看zookeeper的启动状态。如下图 Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"1-chapter/3.activemq.html":{"url":"1-chapter/3.activemq.html","title":"activemq消息中间件","keywords":"","body":"功能描述 ActiveMQ作为消息中间件，主要负责接入设备上传数据，如安保中使用最多的GPS设备发送的MQ消息，接入后，通过适配器入库，实现数据接入。 \\1. 启动ActiveMQ 1) 进入apache-activemq-5.9.0\\bin 2) 执行chmod +x * 赋予执行权限 3) 启动mq，命令为./activemq start ​ 4) 通过tail –f data/activemq.log，查看Activemq运行情况。 \\2. 停止ActiveMQ 1) 进入apache-activemq-5.9.0\\bin 2) 停止mq，命令为./activemq stop 注意：需要通过ps –ef|grep java 命令来确认服务是否被彻底关闭，如mq进程仍存在，请通过kill -9 进程号，关闭进程并再次确认。 Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"1-chapter/4.dubbo.html":{"url":"1-chapter/4.dubbo.html","title":"dubbo监听服务","keywords":"","body":"Dubbo监控服务 功能描述 主要提供dubbo运行状态监控展示服务。因为主要为监控使用，所以即使不启动也不影响系统正常运行，启动只是为了监控各服务是否正常。 服务部署 解压缩dubbo监控服务压缩包（如tomcat6-dubbomonitor.rar），拟拖入/usr/hileg/deploy/thirdparty下，修改tomcat6-dubbomonitor\\ROOT\\WEB-INF下的dubbo.properties文件。修改内容：更新确认zookeeper部署服务的地址、端口号。 #配置服务器的IP+zookeer的端口，因zookeeper默认端口为2181，故只需改服务IP即可。?backup=为备zookeeper,可不进行配置 dubbo.registry.address=zookeeper://10.18.221.134:2181?backup=192.168.50.56:3182 修改tomcat的相关端口，打开tomcat6-dubbo-admin/conf/server.xml按照应用服务器（WEB应用）端口规划的web服务端口9090、Shutdown端口29090、AJP端口29091、redirectPort端口29092进行端口修改（修改下文中↓↓↓+↑↑↑中部分）。 配置完后进入tomcat6-dubbo-admin/bin目录，执行授权命令并启动。 # 假设tomcat6-dubbo-admin在/usr/hileg/deploy/thirdparty目录下，cd命令进入 cd /usr/hileg/deploy/thirdparty/tomcat6-dubbo-admin/bin #授权文件执行权限 chmod 777 * #启动tocmat sh startup.sh 验证 在浏览器地址栏输入http://10.18.221.134:9090/，9090为tomcat对外提供服务的端口号，ip为现场环境IP。 输入用户名root和密码root点击回车。 注意：重启时请通过kill -9 进程号，来杀死进程。并通过ps –ef|grep tomcat6-dubbo命令来确认服务是否被彻底关闭。彻底关闭后在通过启动命令启动。 Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"1-chapter/5.log.html":{"url":"1-chapter/5.log.html","title":"log日志服务","keywords":"","body":"log日志服务 功能描述 为各子系统提供日志记录服务，如用户登录时在系统中记录日志。 服务部署 拟将HiATMP-LOG.zip服务部署在/usr/hileg/deploy/package下，进行解压。 #进入文件夹 cd /usr/hileg/deploy/package #解压 unzip HiATMP-LOG.zip 根据现场情况修改/usr/hileg/deploy/package/HiATMP-LOG/WEB-INF/classes/log.properties文件中相关部，需修改的值为: #数据库密码 jdbc.password=hileg12 #数据库用户名 jdbc.user=hileg12 #数据库连接地址 jdbc.url=jdbc\\:oracle\\:thin\\://@10.16.3.152\\:1521/hiatmpdb #Dubbo ZooKeeper服务器地址，根据现场修改Ip，端口 remoteservice.dubbo.register.address=10.18.221.134:2181 #Dubbo ZooKeeper服务器用户名(预留暂不配置) remoteservice.dubbo.register.username= #Dubbo ZooKeeper服务器密码(预留暂不配置) remoteservice.dubbo.register.password= #Log系统远程服务提供端口，如按规划为2083（如果为2083则不用修改）。注意，并不要求固定端口，但如果多个子系统安装在同一台服务器中，请保证各子系统此处的端口都不一样，并且不能与系统中其它已经占用的端口冲突，否则系统无法正常启动。 remoteservice.dubbo.provider.port=2803 准备tomcat 准备tomcat7以上版本的tomcat，如将apache-tomcat-7.0.59.zip你拖入/usr/hileg/deploy/tomcat/目录，解压该文件。修改apache-tomcat-7.0.59名称为tomcat7-log #进入文件夹 cd /usr/hileg/deploy/tomcat/ #解压 unzip apache-tomcat-7.0.59.zip # 改名 mv apache-tomcat-7.0.59 tocmat7-log 修改tomcat配置文件 打开tocmat7-log/conf/server.xml按照应用服务器（WEB应用）端口规划的web服务端口、Shutdown端口、AJP端口、redirectPort端口,修改tomcat配置文件。 并根据log工程的实际位置，在该文件的标签里添加log相关部署路径。修改完成后如下。（修改下文中↓↓↓+↑↑↑中部分） 启动 配置完后进入tomcat7-log/bin目录，执行授权命令并启动。 # 假设tomcat7-log在/usr/hileg/deploy/tomcat/tomcat7-log目录下，cd命令进入 cd /usr/hileg/deploy/tomcat/tomcat7-log/bin #授权文件执行权限 chmod 777 * #启动tocmat sh startup.sh 关闭 kill -9 进程号 重启 注意：重启时请通过kill -9 进程号，来杀死进程。并通过ps –ef|grep log命令来确认服务是否被彻底关闭。彻底关闭后在通过启动命令启动。 验证 进入dubbo监控页面选择服务， ​ 在SEARCH栏中输入com.hisense.hiatmp.bsp.log.service.ILogService搜索。其搜索到的服务正常则说明部署成功。 Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"1-chapter/6.sso.html":{"url":"1-chapter/6.sso.html","title":"sso单点登录","keywords":"","body":"sso单点登录服务 功能描述 为各子系统和平台提供单点登录认证服务。用户登录平台若没有登录则统一跳转此服务的登录页面，同时此服务提供用户所需的必要安装包，可从登录页中软件下载处进行下载。 服务部署 准备HiATMP-sso工程包 拟将HiATMP-sso.zip服务部署在/usr/hileg/deploy/package下，进行解压。 #进入文件夹 cd /usr/hileg/deploy/package #解压 unzip HiATMP-sso.zip 修改配置文件 根据现场情况修改/usr/hileg/deploy/package/HiATMP-sso/ WEB-INF/classes/sso.properties文件中相关部分，需修改的值为： #用户在线超时时间设置（单位：分钟），根据现场修改 userOnlineOvertime=500 ##数据库相应配置 #数据库密码 jdbc.password=hileg12 #数据库用户名 jdbc.user=hileg12 #数据库连接地址 jdbc.url=jdbc\\:oracle\\:thin\\://@10.16.3.152\\:1521/hiatmpdb ##三平台统一认证, #统一认证开关，false关闭则不用配置oauth.开头的地址 oauth.active=false #三平台申请授权接口（三平台地址），http\\://三平台IP\\:三平台端口/hibis-back/oauth/authorize oauth.authorize-url=http\\://10.16.1.56\\:8182/hibis-back/oauth/authorize #三平台申请令牌接口（三平台地址）http\\://三平台IP\\:三平台端口/hibis-back/oauth/token oauth.token-url=http\\://10.16.1.56\\:8182/hibis-back/oauth/token #三平台获取当前账号接口（三平台地址）http\\://三平台IP\\:三平台端口/hibis-back/oauth/getSubCurrentUser oauth.userinfo-url=http\\://10.16.1.56\\:8182/hibis-back/oauth/getSubCurrentUser #管控在三平台的注册ID （bis_client_register表） oauth.client-id=HIATMP #管控在三平台的注册密钥 （bis_client_register表） oauth.client-secret=5d28b4306d9111ea9e870221860e9b7e #管控在申请授权成功后的回调接口（SSO地址）http\\://SSO_IP\\:SSO_PORT/oauthToLogin oauth.client-tologin=http\\://10.18.221.134\\:801/oauthToLogin #单位：分钟，unit:minute sso.session-timeout=200 ##ZooKeeper相应配置 #Dubbo ZooKeeper服务器地址，根据现场修改Ip，端口 remoteservice.dubbo.register.address=10.18.221.134:2181 #Dubbo ZooKeeper服务器用户名(预留暂不配置) remoteservice.dubbo.register.username= #Dubbo ZooKeeper服务器密码(预留暂不配置) remoteservice.dubbo.register.password= #sso系统远程服务提供端口，如按规划为2801（如果为2801则不用修改）。注意，并不要求固定端口，但如果多个子系统安装在同一台服务器中，请保证各子系统此处的端口都不一样，并且不能与系统中其它已经占用的端口冲突，否则系统无法正常启动。 remoteservice.dubbo.provider.port=2801 ##子系统相应配置 ##以下为wbc依赖子系统服务地址,根据实际部署的子系统，填写相应的属性,属性值如：http://localhost:端口 #基础服务，http://BSP_IP:BSP_PORT module.BSP=http://10.18.221.134:80 #地图服务， http://HIMAP_IP: HIMAP_PORT module.HIMAP=http://10.18.221.134:2181 #工作台服务，http://WBC_IP:WBC_PORT module.WBC=http://10.18.221.134:812 #设备运维服务，http://EOMS_IP:EOMS_PORT module.EOMS=http://10.18.221.134:81 #此处需填写EOMS的IP和端口 http://EOMS_IP: EOMS_PORT module.EOMSBASE=http://10.18.221.134:81 #警卫保障系统 HiLEG http://LEG_IP:LEG_PORT module.LEG=http://10.18.221.134:8002 准备tomcat 准备tomcat7以上版本的tomcat，如将apache-tomcat-7.0.59.zip拟拖入/usr/hileg/deploy/tomcat/目录，解压该文件。修改apache-tomcat-7.0.59名称为tomcat7-sso # 进入文件夹 cd /usr/hileg/deploy/tomcat/ # 解压 unzip apache-tomcat-7.0.59.zip # 改名 mv apache-tomcat-7.0.59 tocmat7-sso 修改tomcat配置文件 打开tocmat7-sso/conf/server.xml按照应用服务器（WEB应用）端口规划的web服务端口、Shutdown端口、AJP端口、redirectPort端口,修改tomcat配置文件。 并根据sso工程的实际位置，在该文件的标签里添加sso相关部署路径。修改完成后如下。（修改下文中↓↓↓+↑↑↑中部分） 个性化配置 sso个性化配置，一般为关闭状态。可修改HiATMP-sso/config/downloadList.json，配置新版权信息展示与使用手册下载功能。 copyright:’0’//1开启版权信息展示，0关闭 readmeshow:’0’//1开启使用手册下载功能，0关闭 启动 配置完后进入tomcat7-sso/bin目录，执行授权命令并启动。 # 假设tomcat7-sso在/usr/hileg/deploy/tomcat/tomcat7-sso目录下，cd命令进入 cd /usr/hileg/deploy/tomcat/tomcat7-sso/bin #授权文件执行权限 chmod 777 * #启动tocmat sh startup.sh 关闭 kill -9 进程号 重启 注意：重启时请通过kill -9 进程号，来杀死进程。并通过ps –ef|grep sso命令来确认服务是否被彻底关闭。彻底关闭后在通过启动命令启动。 验证 进入dubbo监控页面选择服务 ​ 在SEARCH栏中输入com.hisense.hiatmp.sso.service.ISsoService搜索，搜索到的服务正常则说明部署成功。 Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"1-chapter/7.bsp.html":{"url":"1-chapter/7.bsp.html","title":"bsp基础平台","keywords":"","body":"bsp基础管理服务 功能描述 主要包括平台的基础管理服务和为各子系统提供基础信息服务。包括警员管理、部门管理、账号管理等。 服务部署 准备HiATMP-BSP工程包 拟将HiATMP-BSP.zip服务部署在/usr/hileg/deploy/package下，进行解压。 #进入文件夹 cd /usr/hileg/deploy/package #解压 unzip HiATMP-BSP.zip 修改配置文件 根据现场情况修改/usr/hileg/deploy/package/HiATMP-BSP/ WEB-INF/classes/bsp.properties文件中相关部分，需修改的值为： ##数据库相应配置 #数据库密码 jdbc.password=hileg12 #数据库用户名 jdbc.user=hileg12 #数据库连接地址 jdbc.url=jdbc\\:oracle\\:thin\\://@10.16.3.152\\:1521/hiatmpdb ##单点登录相应配置 #bsp系统部署的服务地址，如：http://BSP_IP:BSP_PORT/HiatmpPro/ sso.default-target=http://10.18.221.134:80/HiatmpPro/ #单点登录服务地址，如：http://SSO_IP:SSO_PORT/ sso.root-url=http://10.18.221.134:801/ ##ZooKeeper相应配置 #Dubbo ZooKeeper服务器地址，根据现场修改Ip，端口 remoteservice.dubbo.register.address=10.18.221.134:2181 #Dubbo ZooKeeper服务器用户名(预留暂不配置) remoteservice.dubbo.register.username= #Dubbo ZooKeeper服务器密码(预留暂不配置) remoteservice.dubbo.register.password= #bsp系统远程服务提供端口，如按规划为280（如果为280则不用修改）。注意，并不要求固定端口，但如果多个子系统安装在同一台服务器中，请保证各子系统此处的端口都不一样，并且不能与系统中其它已经占用的端口冲突，否则系统无法正常启动。 remoteservice.dubbo.provider.port=280 ##子系统相应配置 ##以下为bsp依赖子系统服务地址,根据实际部署的子系统，填写相应的属性,属性值如：http://localhost:端口 #基础服务，http://BSP_IP:BSP_PORT module.BSP=http://10.18.221.134:80 #地图服务， http://HIMAP_IP: HIMAP_PORT module.HIMAP=http://10.18.221.134:2181 #工作台服务，http://WBC_IP:WBC_PORT module.WBC=http://10.18.221.134:812 #设备运维服务，http://EOMS_IP:EOMS_PORT module.EOMS=http://10.18.221.134:81 #此处需填写EOMS的IP和端口 http://EOMS_IP: EOMS_PORT module.EOMSBASE=http://10.18.221.134:81 #警卫保障系统 HiLEG http://LEG_IP:LEG_PORT module.LEG=http://10.18.221.134:8002 管控工作台跳转配置：/usr/hileg/deploy/package/HiATMP-BSP/home/bsp/js/url_conf.js //工作台IP:端口地址 var workbenchip = 'http://10.18.221.134:812'; 安保页面工作台跳转地址：/usr/hileg/deploy/package/HiATMP-BSP /home/hileg/config.js //工作台IP:端口地址 var workbenchip = \"http://10.18.221.134:812\"; 准备tomcat 准备tomcat7以上版本的tomcat，如将apache-tomcat-7.0.59.zip拟拖入/usr/hileg/deploy/tomcat/目录，解压该文件。修改apache-tomcat-7.0.59名称为tomcat7-bsp # 进入文件夹 cd /usr/hileg/deploy/tomcat/ # 解压 unzip apache-tomcat-7.0.59.zip # 改名 mv apache-tomcat-7.0.59 tocmat7-bsp 修改tomcat配置文件 打开tocmat7-bsp/conf/server.xml按照应用服务器（WEB应用）端口规划的web服务端口、Shutdown端口、AJP端口、redirectPort端口,修改tomcat配置文件。 并根据bsp工程的实际位置，在该文件的标签里添加bsp相关部署路径。修改完成后如下。（修改下文中↓↓↓+↑↑↑中部分） 启动 配置完后进入tomcat7-bsp/bin目录，执行授权命令并启动。 # 假设tomcat7-bsp在/usr/hileg/deploy/tomcat/tomcat7-bsp目录下，cd命令进入 cd /usr/hileg/deploy/tomcat/tomcat7-bsp/bin #授权文件执行权限 chmod 777 * #启动tocmat sh startup.sh 关闭 kill -9 进程号 重启 注意：重启时请通过kill -9 进程号，来杀死进程。并通过ps –ef|grep bsp命令来确认服务是否被彻底关闭。彻底关闭后在通过启动命令启动。 验证 在浏览器中输入http://BSP_IP:BSP_PORT/HiatmpPro/home/hileg跳转登录页面，输入完默认超级管理员初始账号密码，admin/admin123，则进行跳转入安保BSP页面 也可以从dubbo监控页面查看是否程序启动成功，进入dubbo监控页面选择服务， 在SEARCH栏中输入com.hisense.hiatmp.bsp.auth.service.IAuthService搜索，搜索到的服务正常则说明部署成功。 Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"1-chapter/8.eomsbase.html":{"url":"1-chapter/8.eomsbase.html","title":"eomsbase运维基础","keywords":"","body":"eomsbase运维基础信息服务 功能描述 为各子系统提供快速查询安装点设备等信息的服务。 服务部署 准备HiATMP-EOMS-base工程包 拟将HiATMP-EOMS-base.zip服务部署在/usr/hileg/deploy/package下，进行解压。 #进入文件夹 cd /usr/hileg/deploy/package #解压 unzip HiATMP-EOMS-base.zip 修改配置文件 根据现场情况修改/usr/hileg/deploy/package/HiATMP-EOMS-base/ WEB-INF/classes/eomsbase.properties文件中相关部分，需修改的值为： ##数据库相应配置 #数据库密码 jdbc.password=hileg12 #数据库用户名 jdbc.user=hileg12 #数据库连接地址 jdbc.url=jdbc\\:oracle\\:thin\\://@10.16.3.152\\:1521/hiatmpdb ##单点登录相应配置 #eomsbase系统部署的服务地址，如：http://EOMSBASE_IP:EOMSBASE_PORT/HiatmpPro/ sso.default-target=http://10.18.221.134:812/HiatmpPro/ #单点登录服务地址，如：http://SSO_IP:SSO_PORT/ sso.root-url=http://10.18.221.134:801/ ##ZooKeeper相应配置 #Dubbo ZooKeeper服务器地址，根据现场修改Ip，端口 remoteservice.dubbo.register.address=10.18.221.134:2181 #Dubbo ZooKeeper服务器用户名(预留暂不配置) remoteservice.dubbo.register.username= #Dubbo ZooKeeper服务器密码(预留暂不配置) remoteservice.dubbo.register.password= #eomsbase系统远程服务提供端口，如按规划为2802（如果为2802则不用修改）。注意，并不要求固定端口，但如果多个子系统安装在同一台服务器中，请保证各子系统此处的端口都不一样，并且不能与系统中其它已经占用的端口冲突，否则系统无法正常启动。 remoteservice.dubbo.provider.port=2802 准备tomcat 准备tomcat7以上版本的tomcat，如将apache-tomcat-7.0.59.zip拟拖入/usr/hileg/deploy/tomcat/目录，解压该文件。修改apache-tomcat-7.0.59名称为tomcat7-emosbase # 进入文件夹 cd /usr/hileg/deploy/tomcat/ # 解压 unzip apache-tomcat-7.0.59.zip # 改名 mv apache-tomcat-7.0.59 tocmat7-emosbase 修改tomcat配置文件 打开tocmat7-emosbase/conf/server.xml按照应用服务器（WEB应用）端口规划的web服务端口、Shutdown端口、AJP端口、redirectPort端口,修改tomcat配置文件。 并根据HiATMP-EOMS-base工程的实际位置，在该文件的标签里添加emosbase相关部署路径。修改完成后如下。（修改下文中↓↓↓+↑↑↑中部分） 启动 配置完后进入tomcat7-eomsbase/bin目录，执行授权命令并启动。 # 假设tomcat7-eomsbase在/usr/hileg/deploy/tomcat/tomcat7-eomsbase目录下，cd命令进入 cd /usr/hileg/deploy/tomcat/tomcat7-eomsbase/bin #授权文件执行权限 chmod 777 * #启动tocmat sh startup.sh 关闭 kill -9 进程号 重启 注意：重启时请通过kill -9 进程号，来杀死进程。并通过ps –ef|grep emosbase命令来确认服务是否被彻底关闭。彻底关闭后在通过启动命令启动。 验证访问 进入dubbo监控页面选择服务， 在SEARCH栏中输入com.hisense.hiatmp.eoms.base.equipmaintain.service.IEquipMaintainService:1.0.0搜索，搜索到的服务正常则说明部署成功。 Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"1-chapter/9.wbc.html":{"url":"1-chapter/9.wbc.html","title":"wbc工作台","keywords":"","body":"wbc工作台服务 功能描述 为各子系统提供进入相关页面的服务。 服务部署 准备HiATMP-WBC.zip工程包 拟将HiATMP-WBC.zip服务部署在/usr/hileg/deploy/package下，进行解压。 #进入文件夹 cd /usr/hileg/deploy/package #解压 unzip HiATMP-WBC.zip 修改配置文件 根据现场情况修改/usr/hileg/deploy/package/HiATMP-WBC/ WEB-INF/classes/wbc.properties文件中相关部分，需修改的值为： ##数据库相应配置 #数据库密码 jdbc.password=hileg12 #数据库用户名 jdbc.user=hileg12 #数据库连接地址 jdbc.url=jdbc\\:oracle\\:thin\\://@10.16.3.152\\:1521/hiatmpdb ##单点登录相应配置 #wbc系统部署的服务地址，如：http://WBC_IP:WBC_PORT/HiatmpPro/ sso.default-target=http://10.18.221.134:812/HiatmpPro/ #单点登录服务地址，如：http://SSO_IP:SSO_PORT/ sso.root-url=http://10.18.221.134:801/ ##ZooKeeper相应配置 #Dubbo ZooKeeper服务器地址，根据现场修改Ip，端口 remoteservice.dubbo.register.address=10.18.221.134:2181 #Dubbo ZooKeeper服务器用户名(预留暂不配置) remoteservice.dubbo.register.username= #Dubbo ZooKeeper服务器密码(预留暂不配置) remoteservice.dubbo.register.password= #wbc系统远程服务提供端口，如按规划为2812（如果为2812则不用修改）。注意，并不要求固定端口，但如果多个子系统安装在同一台服务器中，请保证各子系统此处的端口都不一样，并且不能与系统中其它已经占用的端口冲突，否则系统无法正常启动。 remoteservice.dubbo.provider.port=2812 ##子系统相应配置 ##以下为wbc依赖子系统服务地址,根据实际部署的子系统，填写相应的属性,属性值如：http://localhost:端口 #基础服务，http://BSP_IP:BSP_PORT module.BSP=http://10.18.221.134:80 #地图服务， http://HIMAP_IP: HIMAP_PORT module.HIMAP=http://10.18.221.134:2181 #工作台服务，http://WBC_IP:WBC_PORT module.WBC=http://10.18.221.134:812 #设备运维服务，http://EOMS_IP:EOMS_PORT module.EOMS=http://10.18.221.134:81 #此处需填写EOMS的IP和端口 http://EOMS_IP: EOMS_PORT module.EOMSBASE=http://10.18.221.134:81 #警卫保障系统 HiLEG http://LEG_IP:LEG_PORT module.LEG=http://10.18.221.134:8002 准备tomcat 准备tomcat7以上版本的tomcat，如将apache-tomcat-7.0.59.zip拟拖入/usr/hileg/deploy/tomcat/目录，解压该文件。修改apache-tomcat-7.0.59名称为tomcat7-wbc # 进入文件夹 cd /usr/hileg/deploy/tomcat/ # 解压 unzip apache-tomcat-7.0.59.zip # 改名 mv apache-tomcat-7.0.59 tocmat7-wbc 修改tomcat配置文件 打开tocmat7-wbc/conf/server.xml按照应用服务器（WEB应用）端口规划的web服务端口、Shutdown端口、AJP端口、redirectPort端口,修改tomcat配置文件。 并根据HiATMP-WBC工程的实际位置，在该文件的标签里添加wbc相关部署路径。修改完成后如下。（修改下文中↓↓↓+↑↑↑中部分） 启动 配置完后进入tomcat7-wbc/bin目录，执行授权命令并启动。 # 假设tomcat7-wbc在/usr/hileg/deploy/tomcat/tomcat7-wbc目录下，cd命令进入 cd /usr/hileg/deploy/tomcat/tomcat7-wbc/bin #授权文件执行权限 chmod 777 * #启动tocmat sh startup.sh 关闭 kill -9 进程号 重启 注意：重启时请通过kill -9 进程号，来杀死进程。并通过ps –ef|grep wbc命令来确认服务是否被彻底关闭。彻底关闭后在通过启动命令启动。 验证 因为在bsp基础管理服务中配置了WBC的访问ip与端口 安保页面工作台跳转地址：/usr/hileg/deploy/package/HiATMP-BSP/home/hileg/config.js //WBC_IP:WBC_PORT var workbenchip = \"http://10.18.221.134:812\"; 故可通过在安保主页面左上角点击进入工作台。 也可以从dubbo监控页面查看是否程序启动成功，进入dubbo监控页面选择服务， 在SEARCH栏中输入com.hisense.hiatmp.wbc.common.service.ICommonService搜索，搜索到的服务正常则说明部署成功。 Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"1-chapter/10.himap.html":{"url":"1-chapter/10.himap.html","title":"himap地图服务","keywords":"","body":"himap地图服务 功能描述 为平台提供地图通用地图接口，发布下载我瓦片及调用geoserver提供的服务展示地图。 服务部署 准备HiMap.zip工程包 拟将HiMap.zip服务部署在/usr/hileg/deploy/package下，进行解压。 #进入文件夹 cd /usr/hileg/deploy/package #解压 unzip HiMap.zip 修改配置文件 根据现场情况修改/usr/hileg/deploy/package/HiMap/ WEB-INF/classes/himap.properties文件中相关部分，需修改的值为： ##瓦片地址均改成一个地址，瓦片获取方法可通过适配器下载获得 #旧瓦片地址 TILEDFILEPATH = E:/vector/ #新版本瓦片地址 PGISTILEDFILEPATH = E:/vector/ GOOGLETILEDFILEPATH = E:/vector/ ##数据库相应配置 #数据库密码 jdbc.password=hileg12 #数据库用户名 jdbc.user=hileg12 #数据库连接地址 jdbc.url=jdbc\\:oracle\\:thin\\://@10.16.3.152\\:1521/hiatmpdb ##单点登录相应配置 #himap系统部署的服务地址，如：http://HIMAP_IP:HIMAP_PORT/HiMap/ sso.default-target=http://10.16.1.85:804/HiatmpPro/ #单点登录服务地址，如：http://SSO_IP:SSO_PORT/ sso.root-url=http://10.16.1.85:801/ ##ZooKeeper相应配置 #Dubbo ZooKeeper服务器地址，根据现场修改Ip，端口 remoteservice.dubbo.register.address=10.18.221.134:2181 #Dubbo ZooKeeper服务器用户名(预留暂不配置) remoteservice.dubbo.register.username= #Dubbo ZooKeeper服务器密码(预留暂不配置) remoteservice.dubbo.register.password= #himap系统远程服务提供端口，如按规划为2804（如果为2804则不用修改）。注意，并不要求固定端口，但如果多个子系统安装在同一台服务器中，请保证各子系统此处的端口都不一样，并且不能与系统中其它已经占用的端口冲突，否则系统无法正常启动。 remoteservice.dubbo.provider.port=2804 ##子系统相应配置 ##以下为himap依赖子系统服务地址,根据实际部署的子系统，填写相应的属性,属性值如：http://localhost:端口 #地图服务 http://BSP_IP:BSP_PORT module.BSP= http://10.18.221.134:80 根据现场情况修改/usr/hileg/deploy/package/HiMap/himap.js文件中相关部分，需修改的值为HOSTNAME、DEFAULTMAPTYPE 、DOWNLOADVERSION //当前地图服务访问路径\"http://HIMAP_IP:HIMAP_PORT/HiMap/\",; var HOSTNAME = \"http://10.18.221.134:804/HiMap/\" //接口类型填写'arcgis'。 var DEFAULTMAPTYPE = \"arcgis\"， //*********arcgis谷歌离线地图配置项********** var DOWNLOADVERSION = \"2.0\"; // 瓦片下载器版本，根据瓦片下载器版本确定、（1.0版本下所有图片在一个目录，2.0在多个目录中） 准备tomcat 准备tomcat7以上版本的tomcat，如将apache-tomcat-7.0.59.zip拟拖入/usr/hileg/deploy/tomcat/目录，解压该文件。修改apache-tomcat-7.0.59名称为tomcat7-himap # 进入文件夹 cd /usr/hileg/deploy/tomcat/ # 解压 unzip apache-tomcat-7.0.59.zip # 改名 mv apache-tomcat-7.0.59 tocmat7-himap 修改tomcat配置文件 打开tocmat7-himap/conf/server.xml按照应用服务器（WEB应用）端口规划的web服务端口、Shutdown端口、AJP端口、redirectPort端口,修改tomcat配置文件。 并根据HiMap工程的实际位置，在该文件的标签里添加himap相关部署路径。修改完成后如下。（修改下文中↓↓↓+↑↑↑中部分） 启动 配置完后进入tomcat7-himap/bin目录，执行授权命令并启动。 # 假设tomcat7-himap在/usr/hileg/deploy/tomcat/tomcat7-himap目录下，cd命令进入 cd /usr/hileg/deploy/tomcat/tomcat7-himap/bin #授权文件执行权限 chmod 777 * #启动tocmat sh startup.sh 关闭 kill -9 进程号 重启 注意：重启时请通过kill -9 进程号，来杀死进程。并通过ps –ef|grep wbc命令来确认服务是否被彻底关闭。彻底关闭后在通过启动命令启动。​ 验证访问 打开工作台，在系统参数设置中参数代码搜索200，修改2002、2004修改中心点、初始级别。 打开浏览器，输入以下地址进行测试：（ip和端口号根据现场情况进行调整） http://10.16.1.85:804/HiMap/arcgis.html Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"1-chapter/11.eoms.html":{"url":"1-chapter/11.eoms.html","title":"eoms运维系统","keywords":"","body":"eoms设备运维服务 功能描述 为系统提供安装点、设备添加修改服务。 服务部署 准备HiATMP-EOMS.zip工程包 拟将HiATMP-EOMS.zip服务部署在/usr/hileg/deploy/package下，进行解压。 #进入文件夹 cd /usr/hileg/deploy/package #解压 unzip HiATMP-EOMS.zip 修改配置文件 根据现场情况修改/usr/hileg/deploy/package/HiATMP-EOMS/WEB-INF/classes/eoms.properties文件中相关部分，需修改的值为： #数据库密码 jdbc.password=hileg12 #数据库用户名 jdbc.user=hileg12 #数据库连接地址 jdbc.url=jdbc\\:oracle\\:thin\\://@10.16.3.152\\:1521/hiatmpdb #eoms系统部署的服务地址，如：http://EOMS_IP:EOMS_PORT/HiatmpPro/ sso.default-target=http://10.16.1.85:81/HiatmpPro/ #单点登录服务地址，如：http://SSO_IP:SSO_PORT/ sso.root-url=http://10.16.1.85:801/ #Dubbo ZooKeeper服务器地址，根据现场修改Ip，端口 remoteservice.dubbo.register.address=10.18.221.134:2181 #Dubbo ZooKeeper服务器用户名(预留暂不配置) remoteservice.dubbo.register.username= #Dubbo ZooKeeper服务器密码(预留暂不配置) remoteservice.dubbo.register.password= #eoms系统远程服务提供端口，如按规划为281（如果为281则不用修改）。注意，并不要求固定端口，但如果多个子系统安装在同一台服务器中，请保证各子系统此处的端口都不一样，并且不能与系统中其它已经占用的端口冲突，否则系统无法正常启动。 remoteservice.dubbo.provider.port=281 ##以下为emos依赖子系统服务地址,根据实际部署的子系统，填写相应的属性,属性值如：http://localhost:端口 #地图服务 http://HIMAP_IP: HIMAP_PORT module.HIMAP= http://10.18.221.134:804 准备tomcat 准备tomcat7以上版本的tomcat，如将apache-tomcat-7.0.59.zip拟拖入/usr/hileg/deploy/tomcat/目录，解压该文件。修改apache-tomcat-7.0.59名称为tomcat7-eoms # 进入文件夹 cd /usr/hileg/deploy/tomcat/ # 解压 unzip apache-tomcat-7.0.59.zip # 改名 mv apache-tomcat-7.0.59 tocmat7-eoms 修改tomcat配置文件 打开tocmat7-eoms/conf/server.xml按照应用服务器（WEB应用）端口规划的web服务端口、Shutdown端口、AJP端口、redirectPort端口,修改tomcat配置文件。 并根据HiATMP-EOMS工程的实际位置，在该文件的标签里添加eoms相关部署路径。修改完成后如下。（修改下文中↓↓↓+↑↑↑中部分） 启动 配置完后进入tomcat7-eoms/bin目录，执行授权命令并启动。 # 假设tomcat7-eoms在/usr/hileg/deploy/tomcat/tomcat7-eoms目录下，cd命令进入 cd /usr/hileg/deploy/tomcat/tomcat7-eoms/bin #授权文件执行权限 chmod 777 * #启动tocmat sh startup.sh 关闭 kill -9 进程号 重启 注意：重启时请通过kill -9 进程号，来杀死进程。并通过ps –ef|grep eoms命令来确认服务是否被彻底关闭。彻底关闭后在通过启动命令启动。 验证 维护安装点： http://172.29.134.2:81/HiatmpPro/FlexAppFrame.jsp?_w=1356&_h=698&_t=%E5%AE%89%E8%A3%85%E7%82%B9%E7%AE%A1%E7%90%86&_g=eoms&_m=monitorpoint%2FEquip_MonitorPoint_View 维护设备： http://172.29.134.2:81/HiatmpPro/FlexAppFrame.jsp?_w=1356&_h=698&_t=%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF%E7%AE%A1%E7%90%86&_g=eoms&_m=equip%2FEquip_View Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"1-chapter/12.leg.html":{"url":"1-chapter/12.leg.html","title":"leg安保平台","keywords":"","body":"leg警卫安保系统 功能描述 警卫安保系统核心安装包，拥有指挥调度、信号监控、视频跟踪等等页面。 服务部署 准备HiATMP-LEG.zip工程包 拟将HiATMP-LEG.zip服务部署在/usr/hileg/deploy/package下，进行解压。 #进入文件夹 cd /usr/hileg/deploy/package #解压 unzip HiATMP-LEG.zip 修改配置文件 根据现场情况修改/usr/hileg/deploy/package/HiATMP-LEG/WEB-INF/classes/leg.properties文件中相关部分，需修改的值为： ##数据库相应配置 #数据库密码 jdbc.password=hileg12 #数据库用户名 jdbc.user=hileg12 #数据库连接地址 jdbc.url=jdbc\\:oracle\\:thin\\://@10.16.3.152\\:1521/hiatmpdb ##单点登录相应配置 #wbc系统部署的服务地址，如：http://LEG_IP:LEG_PORT/HiatmpPro/ sso.default-target=http://10.18.221.134:8002/HiatmpPro/ #单点登录服务地址，如：http://SSO_IP:SSO_PORT/ sso.root-url=http://10.18.221.134:801/ ##ZooKeeper相应配置 #Dubbo ZooKeeper服务器地址，根据现场修改Ip，端口 remoteservice.dubbo.register.address=10.18.221.134:2181 #Dubbo ZooKeeper服务器用户名(预留暂不配置) remoteservice.dubbo.register.username= #Dubbo ZooKeeper服务器密码(预留暂不配置) remoteservice.dubbo.register.password= #leg系统远程服务提供端口，如按规划为28002（如果为28002则不用修改）。注意，并不要求固定端口，但如果多个子系统安装在同一台服务器中，请保证各子系统此处的端口都不一样，并且不能与系统中其它已经占用的端口冲突，否则系统无法正常启动。 remoteservice.dubbo.provider.port=28002 ##以下为leg依赖子系统服务地址,根据实际部署的子系统，填写相应的属性,属性值如：http://localhost:端口 #地图服务 http://HIMAP_IP: HIMAP_PORT module.HIMAP= http://10.18.221.134:804 #FTP用户名 ftpusername=hiatmp #FTP密码 ftppassword=hiatmp # MQ用户 mq_user=hiatmp # MQ密码 mq_password=hiatmp #修改MQ的IP地址+端口 mq_server=tcp\\://10.18.221.134\\:61616?jms.optimizeAcknowledge=true&jms.optimizeAcknowledgeTimeOut=3000 #videoService服务器地址 video_service_address=10.18.221.134 #LEG后台IP地址:端口 leg_websocket=ws\\://10.18.221.134\\:8002/HiatmpPro/legwebsocket #信号控制是否接入redis缓存，根据现场确定是否开启redis存储,为false时不需要修改以下参数↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓ signalOpenRedis=false # redis signal 单机模式 cluster 集群模式 reids_model_type=cluster #集群模式ip及端口 addressList=10.18.221.134:6379|192.168.30.139:7001|192.168.30.139:7002|192.168.30.139:7003|192.168.30.139:7004|192.168.30.139:7005 # redis setting signal 单机模式Ip hostName=10.18.221.134 # redis setting signal 单机模式端口 port=6379 # redis setting common # redis密码 password=hileg 准备tomcat 准备tomcat7以上版本的tomcat，如将apache-tomcat-7.0.59.zip拟拖入/usr/hileg/deploy/tomcat/目录，解压该文件。修改apache-tomcat-7.0.59名称为tomcat7-leg # 进入文件夹 cd /usr/hileg/deploy/tomcat/ # 解压 unzip apache-tomcat-7.0.59.zip # 改名 mv apache-tomcat-7.0.59 tocmat7-leg 修改tomcat配置文件 打开tocmat7-leg/conf/server.xml按照应用服务器（WEB应用）端口规划的web服务端口、Shutdown端口、AJP端口、redirectPort端口,修改tomcat配置文件。 并根据HiATMP-LEG工程的实际位置，在该文件的标签里添加leg相关部署路径。修改完成后如下。（修改下文中↓↓↓+↑↑↑中部分） 启动 配置完后进入tomcat7-leg/bin目录，执行授权命令并启动。 # 假设tomcat7-leg在/usr/hileg/deploy/tomcat/tomcat7-leg目录下，cd命令进入 cd /usr/hileg/deploy/tomcat/tomcat7-leg/bin #授权文件执行权限 chmod 777 * #启动tocmat sh startup.sh 关闭 kill -9 进程号 重启 注意：重启时请通过kill -9 进程号，来杀死进程。并通过ps –ef|grep leg命令来确认服务是否被彻底关闭。彻底关闭后在通过启动命令启动。 验证 在安保页面打开警卫要素进行验证 也可以从dubbo监控页面查看是否程序启动成功，进入dubbo监控页面选择服务， 在SEARCH栏中输入com.hisense.hileg.service.ISignalUtils搜索，搜索到的服务正常则说明部署成功。 Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"2-chapter/":{"url":"2-chapter/","title":"应用服务器(适配器)","keywords":"","body":"安保适配器之间关系 车队通过手机安装App，与HiLEG_IST适配器连接。 HiLEG_IST适配器向mq主题HIATMP.HISENSE.GPS发送报文。 LEG_GPS_SERVER接收HIATMP.HISENSE.GPS报文，处理后入数据库LEG_GPS_DATA表；同时向mq主题HIATMP.HISENSE.HILEG.GPSINF发送车队进行数据。 信号自动勤务接受HIATMP.HISENSE.HILEG.GPSINF数据，进行信号灯控制。 Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:54:04 "},"2-chapter/1.adapeter-port.html":{"url":"2-chapter/1.adapeter-port.html","title":"端口规划","keywords":"","body":"应用服务器（适配器）端口规划 适配器 适配器 说明 端口 ftp服务 21 vip-fake-gps-adapter服务 vip模拟适配器 8777 Hibisadapter服务 同步三平台数据 3131 LEG_GPS_SERVER GPS入库转发适配器 GpsDutyMonitorAdapterSender GPS入库转发适配器 HikTransAdapter 对接海康B20投屏适配器 tomcat服务 tomcat的conf目录下server.xml tomcat的conf目录下server.xml tomcat的conf目录下server.xml tomcat的conf目录下server.xml web服务端口 Shutdown端口 AJP端口 redirectPort端口 1 tomcat-ftp2http 789 17890 17891 17892 2 videoService 8081 18080 18081 18082 3 geoserver-2.12.2 8088 18880 18881 18882 Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"2-chapter/2.Geoserver.html":{"url":"2-chapter/2.Geoserver.html","title":"Geoserver","keywords":"","body":"Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"2-chapter/3.videoService.html":{"url":"2-chapter/3.videoService.html","title":"videoService","keywords":"","body":"数据准备 流媒体数据准备 登录管控平台后，【基础信息】->【设备管理】->【设备信息管理】页面中点击【添加】按钮 弹出【请选择设备类型】对话框后选择“流媒体服务器” 弹出【添加设备信息】对话框 需要记录【设备编号】信息，以配置在VideoService中。 填写【设备名称】部分，以供添加视频监控设备时选择。 添加【安装信息】部分的【设备IP】，【端口】，【操作用户】，【查看用户】以及两个【密码部分】，其中操作用户是指可以控制云台的用户，查看用户是不能控制云台的用户，如果不需要区分的话，可以填写相同的用户名和密码。 这个部分的信息是指第三方平台测试Demo的登录信息，注意不是第三方平台Web页面的登录信息，也不是第三方平台流媒体服务器的相关信息。 其他信息根据项目情况如实填写即可。 如果对接多个平台或者多个NVR设备，则需要增加多个流媒体服务器信息。 视频监控数据准备 登录管控平台后，【基础信息】->【设备管理】->【设备信息管理】页面中点击【添加】按钮 弹出【请选择设备类型】对话框后选择“视频监控” 弹出【添加设备信息】对话框 【流媒体服务】选择设备所对应的流媒体服务的名称，注意此部分为上一步中添加的流媒体服务。 如果添加的NVR下的摄像机，则需要填写对应的通道，第三方编号只要保证在管控平台数据库中唯一即可。 如果添加的是第三方平台的摄像机，则不需要填写通道号，只需要填写第三方编号信息，另外，如果第三方编号超过18位时，需要注意，页面填写会有截断现象，需要手动修改数据库中的第三方编号信息。 其他信息如实填写即可。 Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"2-chapter/4.ftp.html":{"url":"2-chapter/4.ftp.html","title":"ftp","keywords":"","body":"Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"2-chapter/5.tomcat-ftp2http.html":{"url":"2-chapter/5.tomcat-ftp2http.html","title":"tomcat-ftp2http","keywords":"","body":"功能描述 将ftp服务上的存储的路径，通过http形式直接调用，使Chrome浏览器可访问到ftp服务器上的资源 服务部署 将tomcat安装包拖入相关目录/usr/hileg/deploy/tomcat/tomcat-ftp2http 解压安装文件： unzip apache-tomcat-7.0.59.zip 按照应用服务器2（适配器）端口规划修改/usr/hileg/deploy/tomcat/tomcat-ftp2http/conf/server.xml文件中的web服务端口、Shutdown端口、AJP端口、redirectPort端口 同时注意在相同文件下添加编码格式，即connector中需添加URIEncoding=\"UTF-8\" maxPostSize=\"0\"如下图。 ​ 配置ftp相关路径，比如研发的ftp根路径配置为“/usr/hileg/adapter/apache-ftpserver-1.1.1/res/home”，则需将/usr/hileg/deploy/tomcat/tomcat-ftp2http/conf/server.xml中添加相关目录 赋权启动启动tomcat cd /usr/hileg/deploy/tomcat/tomcat-ftp2http/bin chmod 777 * sh startup.sh 修改系统参数 根据实际在工作台中系统参数修改里修改LEG_FTP_HOSTNAME、LEG_FTP_PORT、LEG_HTTP_HOSTNAME、LEG_HTTP_PORT Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"2-chapter/6.LEG_GPS_SERVER.html":{"url":"2-chapter/6.LEG_GPS_SERVER.html","title":"LEG_GPS_SERVER","keywords":"","body":"LEG_GPS_SERVER 功能描述 该模块主要负责平台设备GPS发送的MQ数据的接入，预处理后存储功能。 服务部署 将LEG_GPS_SERVER.zip放入/usr/hileg/deploy/adapter下，unzip解压。 unzip LEG_GPS_SERVER.zip 打开安装目录的/usr/hileg/deploy/adapter /LEG_GPS_SERVER/bin文件夹,修改： appconfig.xml config.properties database.properties 1. 状态检查 启动该模块前请先检查能否正常登陆服务器，数据库能否正常登陆和查询，数据库相关表是否锁定。 2. 启动和关闭方式 1) 启动方式 输入命令sh startServer.sh即可启动服务。 2) 关闭方式 输入命令sh stopServer.sh即可启动服务。 3. 查看模块运行状态 输入命令ps-ef|grep LEG_GPS_SERVER，单击回车键，如果显示进程编号于进程名称则表示进程正在运行，否则说明程序已停止运行。 4. 查看模块运行日志 输入命令cd logs即可进入程序日志所在目录，可以使用下面的命令对日志进行查看： cat 日志文件名 如果需要导出，请使用WinSCP软件登录，双击进入日志目录，将文件拖拽出来进行导出。 5. 检查某设备数据入库情况 使用PLSQL程序登陆数据库，新建SQL查询如图所示。 输入查询语句，如 select*from leg_gps_data where cvehid ='370213000000120009'orderby datasavetime desc 即可查询设备号为370213000000120009设备上传的GPS数据，其他设备的按照此格式替换设备号即可。如下图，拖动下方滚动条即可找到DATASAVETIME项，由上到下即为由新到旧按照时间排列的最新数据，DECARLONG和DCARLAT分别为设备上传的GPS的经度和纬度，NVEHSPEED为设备上传的的速度值（公里/时）。 Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"2-chapter/7.GpsDutyMonitorAdapterSender.html":{"url":"2-chapter/7.GpsDutyMonitorAdapterSender.html","title":"GpsDutyMonitorAdapterSender","keywords":"","body":"普通Gps模拟适配器（自测用） 功能描述 普通Gps模拟适配器仅为在现场暂未有真实Gps上传的情况下使用，主要功能时进行GPS的Mq数据模拟功能。当现场有Gps时此适配器不再使用，也可不进行部署。 服务部署 1.将GpsDutyMonitorAdapterSender_oracle12c.zip安装包拖入相关目录/usr/hileg/deploy/adapter 2.解压文件： unzip GpsDutyMonitorAdapterSender_oracle12c.zip； 3.打开文件 cd /usr/hileg/adapter/GpsDutyMonitorAdapterSender/bin/ 配置：config.properties mq的Ip端口 MQUrl=tcp://10.18.221.134:61616 GPSTopic=HIATMP.HISENSE.GPS CommandTopic=HIATMP.HISENSE.LEGINFO #mq的用户 MQUSER=hiatmp #mq的密码 MQPwd=hiatmp 配置：db.properties 安保数据库的Ip端口实例名 url=jdbc:oracle:thin://@10.16.3.152:1521/hiatmpdb #安保数据库的用户名 username=hileg12 #安保数据库密码 password=hileg12 1) 状态检查 ps -ef|grep GpsDutyMonitorAdapterSender 2) 启动和关闭方式 注意先赋权限：chmod 777 * 启动命令：./startSender.sh ​ 停止命令：./stopSender.sh 3) 查看日志 tail -f log/GpsDutyMonitorAdapter.log Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"2-chapter/8.vip-fake-gps-adapter.html":{"url":"2-chapter/8.vip-fake-gps-adapter.html","title":"vip-fake-gps-adapter","keywords":"","body":"VIP任务GPS模拟适配器 功能描述 vip-fake-gps-adapte是将没有实时GPS的VIP任务路线通过预设速度逐一模拟出来的适配器，同时在任务进行的同时，接收过车数据辅助定位。 服务部署 1、将vip-fake-gps-adapter.zip放入/usr/hileg/deploy/adapter下，unzip解压. 2、对/usr/hileg/adapter/deploy/vip-fake-gps-adapter/config下： application.yml，进行配置。 注意：application.yml为加密后的文档，可通过application_base.yml中的内容拷贝入application.yml中，然后根据提示，只配置#下方的内容。系统启动后自动进行加密（备注也即消失） server: #端口，保证端口值唯一 port: 8777 logging: file: name: ${logging.file.path}/vip-fake-adapter.log #日志存储目录 path: /sdb/hiatmpleg/adapter/hileg/B2/vip-fake-gps-adapter/logs level: root: info spring: cro: activemq: #过车Mq配置--连接过车MQ的url、用户名、密码 brokerUrl: failover:(tcp://10.16.1.106:61616)?randomize=false user: hisense password: hisense #过车Mq配置结束-------------------- topic-name: HIATMP.HISENSE.PASS.PASSINF vip: activemq: #安保Mq配置--连接安保MQ的url、用户名、密码 broker-url: failover:(tcp://10.16.1.106:61616)?randomize=false user: hisense password: hisense #安保Mq配置结束-------------------- queue-name: active topic-name: HIATMP.HISENSE.VIPINFO datasource: #数据库配置--数据库url、用户名、密码 url: jdbc:oracle:thin://@10.16.111.8:1521:hiatmpdb username: hiatmpleg password: hiatmpleg #数据库配置结束--------------------- validation-query: SELECT 1 FROM DUAL ftp: #Ftp配置--安保ftp的地址、端口、用户名、密码 host-name: 10.16.1.214 port: 21 user: hisense password: hisense.1 #Ftp配置结束--------------------------- target-path: /vipfake/ tomcat: #ftp转http的配置--ftp转http的tomcat的Ip地址、端口 target-ip: 10.16.1.214 target-port: 8066 target-url: /vipfake/ #ftp转http的配置结束----------------------------- 1) 状态检查 ps -ef|grep vip-fake-gps-adapter ​ 注意：因vip-fake-gps-adapter为2020年新开发适配器，故适配器要求为1.8jdk， 需要在/usr/hileg/deploy/adapter/vip-fake-gps-adapter/ startServer.sh中配置jdk1.8的放置路径： export JAVA_HOME=/usr/java/jdk1.8.0_172-amd64 2) 启动和关闭方式 赋权： cd /usr/hileg/deploy/adapter/vip-fake-gps-adapter chmod 777 * 启动命令：./startServer.sh 停止命令：./stop-vip-server.sh export JAVA_HOME=/usr/java/jdk1.8.0_172-amd64 3) 查看日志 cd /usr/hileg/deploy/adapter/vip-fake-gps-adapter tail -f logs/vip-fake-adapter.log Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"2-chapter/9.HikTransAdapter.html":{"url":"2-chapter/9.HikTransAdapter.html","title":"HikTransAdapter","keywords":"","body":"HikTransAdapter投大屏适配器 功能描述 HikTransAdapter为投大屏适配器，通过HIATMP.HISENSE.HIKTRANSFER 主题MQ向投屏厂家发送当前车队所处适配的实时状态，视频厂家通过解析MQ信息进行视频在大屏幕投放功能。 注：不同地区大屏幕投放厂家可能不同，故各地可能需要相关投屏厂家的二次开发，故现场如果没有相关需求，或相关投屏厂家无此功能，此适配器可以不进行部署。 服务部署 1.将HikTransAdapter.zip放入/usr/hileg/deploy/adapter下，unzip解压。 unzip HikTransAdapter.zip \\2. 打开安装目录的/usr/hileg/deploy/adapter/HikTransAdapter/bin文件夹,修改：config.properties mq地址 MQUrl=tcp://27.10.24.242:61616 HikTopic=HIATMP.HISENSE.HIKTRANSFER ManualTopic=HIATMP.HISENSE.TASKVIDEO #mq用户名 MQUSER=hiatmp #mq密码 MQPwd=hiatmp video_radius=200 video_group_num=3 #wuhan 视频通道专用参数 video_channel_num=12 video_heart_second=300 # thread pool info threadPool_corePoolSize=10 threadPool_maxPoolSize=20 threadPool_queueCapacity=100 # wuhan定制common_city，其他城市改为其他城市拼音 common_city=wuhan 修改/usr/hileg/deploy/adapter/HikTransAdapter/bin/db.properties 数据库地址 url=jdbc:oracle:thin://@27.10.24.241:1521/hiatmpdb #数据库用户名 username=hileg #数据库密码 password=His#Leg2018 1) 状态检查 ps -ef|grep HikTransAdapter 2) 启动和关闭方式 注意先赋权限： cd /usr/hileg/deploy/adapter/HikTransAdapter chmod 777 * 启动命令：./startServer.sh ​ 停止命令：./stopServer.sh 3) 查看日志 cd /usr/hileg/deploy/adapter/HikTransAdapter/log tail –f HikTransAdapter.log 回到实施总体流程 相关协议 id value 子对象 释意 Cameras 视频数组 Cid1/Cid2//Cid3//Cid4 cid1代表移动车载视频 cid2、cid3、cid4代表普通视频，其中安保分别代表近景、中景、远景视频 Index 摄像机第三方编号，需要和海康平台的设备编号对应起来 DevType 摄像机类型6代表移动车载视频1、2、9代表普通地面视频8代表高点视频 Preset 预置位编号，需要和海康平台对应起来 Gid 任务编号 Mode 投屏模式，目前只用到2 Name 代表任务国家 协议样例： [{\"Cameras\":[{\"Cid\":\"1\",\"DevType\":\"6\",\"Index\":\"37020200001310012511\",\"Preset\":\"-1\"},{\"Cid\":\"2\",\"DevType\":\"9\",\"Index\":\"37021200001310010079\",\"Preset\":\"-1\"}, {\"Cid\":\"3\",\"DevType\":\"1\",\"Index\":\"37021200001310010957\",\"Preset\":\"-1\"}, {\"Cid\":\"4\",\"DevType\":\"2\",\"Index\":\"37029500001310014561\",\"Preset\":\"-1\"}],\"Gid\":\"222X\",\"Mode\":\"2\",\"Name\":\"中国(CHN)\"}] Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"2-chapter/10.hibisadapter.html":{"url":"2-chapter/10.hibisadapter.html","title":"hibisadapter","keywords":"","body":"同步三平数据适配器 功能描述 该适配器可将三平台数据与安保数据做匹配。匹配后可实时同步三平台数据。因服务停止时，启动服务，重启后也可自动获取三平台在此期间未能同步成功的数据。达到数据与三平台一致。 如市场上没有三平台，或不采用三平台维护安保数据，则可直接跳过此章节。 服务部署 启动前确认 如果项目上已有安保平台，且线路中已关联过视频信号机。新上三平台，后续采用三平台维护数据时，需要在启动适配器前做以下步骤，确保不影响之前安保线路数据。 因系统参数LEG_FIRST_FROM_BIS为1时，启动该适配器，适配器会将三平台数据与安保数据进行完全匹配同步。三平台有的数据会添加进来，三平台没有的数据会在安保中逻辑删除。故在适配器启动前需将三平台数据全部维护完整，以防安保将之前数据删除。 在同步前，因路口与信号机的特殊性（一个路口只有一个信号机），故需对三平台信号机路-路口正确性进行检查，可在三平台数据库用以下sql进行排查 --三平台路口id,信号机数 select temp.crossing_code as 路口id, temp.sum as 信号机数 from (select p.crossing_code, count(1) as sum from bis_point p left join bis_device d on d.device_location_code = p.point_code where d.devicetype_id = '111' and d.isactive = '1' group by p.crossing_code) temp where temp.sum > 1 查询到为空时，则说明一个路口只有一个信号机，数据正确，不为空时需对原数据进行修改维护。 在同步前，因视频设备采用第三方编号作为匹配字段。故为增加匹配准确性，视频设备的第三方编号在三平台与安保库中均需唯一。故可在三平台通过以下sql 进行检查。不唯一可能关联错误。 --三平台视频 select temp.sum as 设备使用数,temp.thirdsyscode 第三方编号 from (select count(1) as sum, t.thirdsyscode from bis_device t where t.isactive = '1' and t.devicetype_id = '131' and t.thirdsyscode is not null group by t.thirdsyscode) temp where temp.sum > 1; 如果三平台已有，安保平台新部署，则可跳过以下启动前检查步骤 在管控平台通过以下sql 进行检查 --管控视频 select temp.sum 设备使用数, temp.thirdsyscode as 第三方编号 from (select e.thirdsyscode, count(1) as sum from equipment_info e where e.devicetype = '13' and e.thirdsyscode is not null group by e.thirdsyscode) temp where temp.sum > 1; 为防止程序因不明原因报错，导致数据删除无法回退，需备份之前安保库中数据，确保数据可回退，可在安保库中执行以下sql: truncate table route_intsid_pointcode ; insert into route_intsid_pointcode select * from route_intsid_pointcode1; truncate table route_unique_intersection; insert into route_unique_intersection select * from route_unique_intersection1; truncate table role_resource_relation; insert into role_resource_relation select * from role_resource_relation1; truncate table monitor_point; insert into monitor_point select * from monitor_point1; truncate table equipment_info; insert into equipment_info select * from equipment_info1; truncate table leg_line_road_utc_relation; insert into leg_line_road_utc_relation select * from leg_line_road_utc_relation1; commit; --删除 DELETE FROM MONITOR_POINT_GEOMETRY; COMMIT; --插入 INSERT INTO MONITOR_POINT_GEOMETRY (POINTCODE, GEOMETRY) SELECT T.POINTCODE, MDSYS.SDO_GEOMETRY(2001, 8307, MDSYS.SDO_POINT_TYPE(T.LONGITUDE, T.LATITUDE, NULL), NULL, NULL) FROM MONITOR_POINT T WHERE T.LONGITUDE > 0 AND T.LATITUDE > 0; COMMIT; 在同步前，为尽可能全部使用三平台视频设备，可物理删除之前安保库中线路岗位等未使用的视频设备（同步后即使用三平台视频设备），可在安保库中执行以下sql。 --删除安保库中未使用到的视频设备。 delete from equipment_info e where e.devicetype = '13' and e.deviceid not in (select distinct (temp.video_id) from (select t.video_id from leg_line_video_relation t where t.video_id is not null union select a.video_id from LEG_GUIDE_CAR a where a.video_id is not null union select b.video_id from LEG_BASE_VIDEO_RELATION b where b.video_id is not null -- 隐患点，清障车，岗位 union select c.video_equip_id as video_id from Leg_Vip_Video_Relation c where c.video_equip_id is not null union select d.video_id from LEG_VIP_CROSS_VIDEO_LEARNED d where d.video_id is not null) temp); 安保数据库中的车载GPS设备数据一定要在三平台GPS数据中维护且设备id一致，否则可能首次同步时，因无法产生匹配关系，导致逻辑删除安保库中已有的车载GPS设备数据。 --安保平台车载GPS设备 select e.* from equipment_info e where e.devicetype = '12' and e.gpstype = '1'; --三平台GPS数据，需根据上文中查出的id修改下面(''); select * from bis_device t where t.devicetype_id = '121' and t.isactive = '1' and device_code in (''); 两库查询的数量应一致。 注意： 1.目前该适配器只同步安保中使用的路口，安装点，信号机/视频/诱导/gps/电警/卡口设备。如果有同步三平台其他数据或字段需要，请联系研发确认是否可修改配置同步。 2.此适配器在同步三平台视频预置位时需三平台视频设备模型特殊配置： 三平台视频类型需有VIDEOPRESET字段，并采用以下格式才可同步成功 预置位号1:预置位名1;预置位号2:预置位名2 如下图三平台视频设备配置，VIDEOPRESET(不用区分大小写) 同步预置位逻辑为：当预置位字段为空时不进行同步，不为空时进行同步。 修改配置 将hibisadapter.zip放入/usr/hileg/deploy/adapter下，unzip解压。 unzip hibisadapter.zip 打开安装目录的/usr/hileg/deploy/adapter/hibisadapter文件夹,修改startServer.sh，因适配器需要jdk1.8启动，故需要修改1.8java路径 export JAVA_HOME=/usr/java/jdk1.8.0_172-amd64 打开安装目录的/usr/hileg/deploy/adapter/hibisadapter文件夹,修改：application.yml，然后根据提示，配置修改#下方的内容。系统启动后自动进行加密（备注也即消失） server: #适配器监听端口,根据项目现场进行修改，除非端口号冲突，否则不用修改 port: 3131 datasource: # 管控平台数据库地址、账号、密码,根据项目现场进行修改 jdbc-url: jdbc:oracle:thin:@10.16.3.152:1521/hiatmpdb #数据库账号 password: hileg12 #数据库密码 username: hileg12 value: #默认部门编号,当设备无部门号时采用此编号开头 departmentid: 37020000000 #三平台VIDEOPRESET 采用 预置位号1:预置位名1;预置位号2:预置位名2 格式进行维护才可同步成功 videoPreset: true #修改为安保平台bsp的Ip,端口 bspUrl: http://10.18.221.134:80/HiatmpPro # 三平台接口，用于实时同步三平台数据,配置三平台服务地址IP:端口 hibisurl0: http://10.18.221.134:8283/hibis-back/dataservice/getData hibisurl1: http://10.18.221.134:8283/hibis-back/dataservice/getFailDataByPlat hibisurl2: http://10.18.221.134:8283/hibis-back/dataservice/updateResultByPlat 打开三平台的安装目录，修改三平台的配置文件：application.yml dataupdate: active: true tables: HILEG: BIS_DEVICE,BIS_POINT,BIS_CROSSING url: #根据现场hibisadapter部署地址及端口修改ip和端口 HILEG: http://10.18.221.134:3131/bisDataRealTimeSync/updateDataSync 注意：HILEG: http://10.18.221.134:3131/bisDataRealTimeSync/updateDataSync 10.18.221.134为hibisadapter部署服务器ip 3131为hibisadapter适配器上文中配置的端口，如果没有修改即为3131 形如： 启动与运维 启动和关闭方式 注意先赋权限： cd /usr/hileg/deploy/adapter/hibisadapter chmod 777 * 启动命令：./startServer.sh 停止命令：./stopServer.sh 查看日志 cd /usr/hileg/deploy/adapter/hibisadapter/logs tail –f hibisadapter.log 当匹配完成三平台数据时，LEG_FIRST_FROM_BIS置为0，即开启实时同步。当适配器因不明原因停止或忘记启动时。该系统参数不用修改，仍为0启动。适配器将自动同步停止期间三平台维护的数据。保证两边数据一致。 Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"3-other/":{"url":"3-other/","title":"其他服务","keywords":"","body":"Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"3-other/2.hicon.html":{"url":"3-other/2.hicon.html","title":"HiLEG-信号","keywords":"","body":"Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"3-other/3.hileg-hicon.html":{"url":"3-other/3.hileg-hicon.html","title":"hileg-hicon","keywords":"","body":"Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"3-other/4.VideoDownHandlerAdapter.html":{"url":"3-other/4.VideoDownHandlerAdapter.html","title":"VideoDownHandlerAdapter","keywords":"","body":"VideoDownHandlerAdapter历史视频下载 功能描述 视频下载适配器是当现场有云存储环境时才可使用。提供调用回放追溯页面调用第三方视频下载接口使用。如果现场无此功能，可不进行部署。 服务部署 1、 视频下载适配器依赖视频控件，首先需要安装视屏控件，默认安装即可，默认安装在windows服务器C:\\Program Files (x86)\\Hisense\\CommonCMSOCX文件夹下。如下图所示。 ​ 打开视频控件安装目录（Hisense\\CommonCMSOCX\\）下的test.html文件查找clsid，如下图所示。 将clsid值复制到bin目录下的config.properties配置文件中的ACTIVEX_CLSID以及视频服务地址LoginUrl，如下图。 2、 安装32位1.7版本的JDK，打开文件夹下的jacob-1.8的文件夹找到带有x86的dll文件，如下图： 将解压出来的32位dll文件（x86.dll）放在视频下载服务服务器上32位JDk目录的%JAVA_HOME%\\bin下(需同视频控件一致，因视频控件是32位，只能使用32位dll文件，只能在32位JDK中调用视频控件) 最后在根目录下的run.bat中修改上面引用jdk的目录。 3、 在发布包中适配器目录下找到并解压ffmpeg压缩包，将解压ffmpeg文件夹放到视频下载服务器上的C:\\Program Files (x86)\\Hisense\\ffmpeg文件（视频控件安装目录）下，ffmpeg是视频转码工具，将下载的视频转码成浏览器可以播放的视频。 4、 在视频下载服务器上创建本地视频下载以及转码缓存的文件夹D:\\Hinsense\\video，在config.properties配置文件中给VIDEO_LOCAL_DIR、VIDEO_CACHE_DIR赋值，如下图所示。 5、 在bin目录下的config.properties中配置视频上传FTP服务器，配置ip、用户名、密码、以及FTP目录。如图： 6、 在要上传的FTP服务器上搭建Ftp转HTTP访问的tomcat服务， 在tomcat的conf文件夹中将server.xml末尾的context 的dobase属性指向视频上传文件（以部署环境为准），将FTP服务器的ip地址以及tomcat配置的端口号配置到bin目录下的config.properties的相关参数。 7、 在bin目录中的ConnectorTask.xml中配置MQ地址以及端口号。 8、 在bin目录下的dbcp-config.properties配置文件中配置数据连接地址、用户名、密码。 9、适配器中需配置下载以及通信相关MQ主题，如下 VIDEODOWN_WEBSOCKET_TOPIC=HIATMP.HISENSE.VIDEODOWN 视频下载主题 VIDEODOWN_REC_TOPIC=HIATMP.HISENSE.VIDEODOWNREC 适配器通讯主题 VIDEODOWN_CANCLE_TOPIC=HIATMP.HISENSE.VIDEODOWNCANCLE视频下载取消主题 10、 安保平台的配置文件中需添加以下MQ主题： video_down_topic=HIATMP.HISENSE.VIDEODOWN 视频下载主题 video_down_rec_topic=HIATMP.HISENSE.VIDEODOWNREC 适配器通讯主题 video_down_cancle_topic=HIATMP.HISENSE.VIDEODOWNCANCLE视频下载取消主题 11、 配置完毕后双击run.bat启动适配器，正常启动后显示数据库Mq服务器连接成功等信息。 12、 关闭适配器直接点击运行窗口右上角的关闭按钮即可。­ Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "},"3-other/5.HiLEG_IST.html":{"url":"3-other/5.HiLEG_IST.html","title":"HiLEG_IST","keywords":"","body":"HiLEG_IST手机终端连接器 功能描述 HiLEG_IST通过websocket与手机实现常连接，(手机通过VPN在专网内实现连接)。连接后任务启动，手机终端实时向IST发送位置信息，IST将这些位置信息编码为指定GPS的MQ格式向MQ适配器发送。实现实时GPS的接收转发功能。 服务部署 HiLEG_IST也可能在打通网络的特殊服务器部署，故这里只说明部署方法。 1.将tomcat安装包拖入相关目录/usr/hileg/deploy/tomcat/ 解压tomcat安装包，unzip apache-tomcat-7.0.59.zip 修改tomcat包名称为tomcat-HiLEG_IST 2.解压安装文件： 将HiLEG_IST.zip放入/usr/hileg/deploy/tomcat/tomcat-video/webapps下解压 unzip HiLEG_IST.zip 3.按照以上规划修改/usr/hileg/deploy/tomcat/tomcat-HiLEG_IST /conf/server.xml文件中的web服务端口、Shutdown端口、AJP端口、redirectPort端口 4.修改/usr/hileg/deploy/tomcat/tomcat-HiLEG_IST webapps/HiLEG_IST/WEB-INF/classes/hist.properties 数据库密码、用户名、端口实例 jdbc.password=hileg12 jdbc.user= hileg12 jdbc.url=jdbc\\:oracle\\:thin\\://@10.16.3.152\\:1521/hiatmpdb #mq地址端口、用户名、密码 MQUrl=tcp\\://10.18.221.134\\:61616 MQUSER=hiatmp MQPwd=hiatmp #安保tomcat的ip地址，端口 leg_url=http\\://192.168.50.56\\:8002/HiatmpPro/leg/cs/updateTaskStatus #安保版本,1.2则需改为1.2 version=1.2 5.赋权启动tomcat-HiLEG_IST cd /usr/hileg/deploy/tomcat/tomcat-HiLEG_IST/bin chmod 777 * sh startup.sh Copyright © 青岛海信网络科技股份有限公司 all right reserved，powered by Gitbook该文件修订时间： 2022-04-01 11:53:17 "}}